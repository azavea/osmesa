{"paragraphs":[{"text":"import geotrellis.proj4._\nimport geotrellis.spark._\nimport geotrellis.spark.io._\nimport geotrellis.spark.io.file._\nimport geotrellis.spark.io.index.ZCurveKeyIndexMethod\nimport geotrellis.spark.io.s3.{S3AttributeStore, S3LayerWriter}\nimport geotrellis.spark.tiling._\nimport geotrellis.vectortile.VectorTile\nimport org.apache.log4j.{Level, Logger}\nimport org.apache.spark._\nimport org.apache.spark.rdd.RDD\nimport org.apache.spark.sql._\nimport vectorpipe._\nimport vectorpipe.util.LayerMetadata\nimport cats.implicits._\nimport com.monovore.decline._\n","user":"anonymous","dateUpdated":"2017-09-14T04:28:51+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport geotrellis.proj4._\n\nimport geotrellis.spark._\n\nimport geotrellis.spark.io._\n\nimport geotrellis.spark.io.file._\n\nimport geotrellis.spark.io.index.ZCurveKeyIndexMethod\n\nimport geotrellis.spark.io.s3.{S3AttributeStore, S3LayerWriter}\n\nimport geotrellis.spark.tiling._\n\nimport geotrellis.vectortile.VectorTile\n\nimport org.apache.log4j.{Level, Logger}\n\nimport org.apache.spark._\n\nimport org.apache.spark.rdd.RDD\n\nimport org.apache.spark.sql._\n\nimport vectorpipe._\n\nimport vectorpipe.util.LayerMetadata\n\nimport cats.implicits._\n\nimport com.monovore.decline._\n"}]},"apps":[],"jobName":"paragraph_1505348453627_2110725530","id":"20170912-192002_1003937889","dateCreated":"2017-09-14T00:20:53+0000","dateStarted":"2017-09-14T04:28:51+0000","dateFinished":"2017-09-14T04:29:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2163"},{"text":"      /* Settings compatible for both local and EMR execution */\n      val conf = new SparkConf()\n        .setIfMissing(\"spark.master\", \"local[*]\")\n        .setAppName(\"vp-orc-io\")\n\n      implicit val ss: SparkSession = SparkSession.builder\n        .config(conf)\n        .enableHiveSupport\n        .getOrCreate\n","user":"anonymous","dateUpdated":"2017-09-14T04:30:04+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nconf: org.apache.spark.SparkConf = org.apache.spark.SparkConf@7da11c3f\n\nss: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@6d54e3e0\n"}]},"apps":[],"jobName":"paragraph_1505348453631_2109186535","id":"20170912-192013_1465160975","dateCreated":"2017-09-14T00:20:53+0000","dateStarted":"2017-09-14T04:30:04+0000","dateFinished":"2017-09-14T04:30:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2164"},{"text":"val orc = \"s3://vectortiles/orc/europe/finland.orc\"\n//val df = ss.read.orc(\"s3://vectortiles/orc/europe/finland.orc\")\n//val df = ss.read.orc(\"s3://osm-pds/planet/planet-latest.orc\")","user":"anonymous","dateUpdated":"2017-09-14T05:05:39+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\norc: String = s3://vectortiles/orc/europe/finland.orc\n"}]},"apps":[],"jobName":"paragraph_1505348453632_-2101520752","id":"20170912-195450_1591677940","dateCreated":"2017-09-14T00:20:53+0000","dateStarted":"2017-09-14T04:30:09+0000","dateFinished":"2017-09-14T04:30:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2165"},{"text":"df\n    .select(\"lat\", \"lon\", \"id\", \"user\", \"uid\", \"changeset\", \"version\", \"timestamp\", \"tags\")\n    .where(\"user = 'lossyrob'\")\n    .count()\n","dateUpdated":"2017-09-14T00:20:53+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nres19: Long = 610\n"}]},"apps":[],"jobName":"paragraph_1505348453632_-2101520752","id":"20170912-195924_708474401","dateCreated":"2017-09-14T00:20:53+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:2166"},{"text":"      val layout: LayoutDefinition =\n        ZoomedLayoutScheme.layoutForZoom(14, WebMercator.worldExtent, 512)\n\n\n      osm.fromORC(orc) match {\n        case Left(e) => println(e)\n        case Right((ns,ws,rs)) => {\n          val nodePartitioner = new HashPartitioner(100)\n          val wayPartitioner = new HashPartitioner(100)\n\n          /* Reproject nodes */\n\n          val reprojectedNodes =\n            ns.partitionBy(nodePartitioner).mapPartitions({ partition =>\n              val transform = Proj4Transform(LatLng, WebMercator)            \n              partition.map { case (nodeId, node) =>\n                val (lon, lat) = transform(node.lon, node.lat)\n                (nodeId, node.copy(lon = lon, lat = lat))\n              }\n            }, preservesPartitioning = true)\n\n          /* Assumes that OSM ORC is in LatLng */\n          val feats: RDD[osm.OSMFeature] =\n            osm.toFeatures(reprojectedNodes, ws.partitionBy(wayPartitioner), rs)\n            \n          // feats.count()\n\n          /* Associated each Feature with a SpatialKey */\n          val fgrid: RDD[(SpatialKey, Iterable[osm.OSMFeature])] =\n            VectorPipe.toGrid(Clip.byHybrid, VectorPipe.log4j, layout, feats)\n\n          /* Create the VectorTiles */\n          val tiles: RDD[(SpatialKey, VectorTile)] =\n            VectorPipe.toVectorTile(Collate.withoutMetadata, layout, fgrid)\n            \n          tiles.count()\n        }\n      }\n","user":"anonymous","dateUpdated":"2017-09-14T04:30:27+0000","config":{"colWidth":12,"results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nlayout: geotrellis.spark.tiling.LayoutDefinition = GridExtent(Extent(-2.0037508342789244E7, -2.0037508342789244E7, 2.0037508342789244E7, 2.0037508342789244E7),4.777314267823516,4.777314267823516)\n\nres7: AnyVal = 410952\n"}]},"apps":[],"jobName":"paragraph_1505348453633_-2101905501","id":"20170912-200623_759453934","dateCreated":"2017-09-14T00:20:53+0000","dateStarted":"2017-09-14T04:30:27+0000","dateFinished":"2017-09-14T04:57:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2167"},{"dateUpdated":"2017-09-14T02:43:56+0000","config":{"colWidth":12,"editorMode":"ace/mode/scala","results":{},"enabled":true,"editorSetting":{"language":"scala","editOnDblClick":false}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505348453634_-2100751254","id":"20170912-205311_1762819321","dateCreated":"2017-09-14T00:20:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2168","text":"val n = \n osm.fromORC(orc) match {\n        case Left(e) => println(e); None\n        case Right((ns,ws,rs)) => {\n            Some(ns.first())\n        }\n        \n }","user":"anonymous","dateFinished":"2017-09-14T02:44:18+0000","dateStarted":"2017-09-14T02:43:56+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nn: Option[(Long, vectorpipe.osm.Node)] = Some((115878,Node(66.4971622,25.7304937,ElementData(ElementMeta(115878,BoomEngine,288925,14626250,5,2013-01-12 19:13:09.0,true),Map(),None))))\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505356775275_-1908824339","id":"20170914-023935_1728759823","dateCreated":"2017-09-14T02:39:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2902","text":"// FOR THE WHOLE PLANET\nval df = ss.read.orc(\"s3://osm-pds/planet/planet-latest.orc\")\ndf\n    .select(\"id\")\n    .where(\"type != 'node'\")\n    .count()\n    ","dateUpdated":"2017-09-14T02:55:36+0000","dateFinished":"2017-09-14T02:56:34+0000","dateStarted":"2017-09-14T02:55:36+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndf: org.apache.spark.sql.DataFrame = [id: bigint, type: string ... 10 more fields]\n\nres17: Long = 440490961\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505357160501_1656073435","id":"20170914-024600_1268527826","dateCreated":"2017-09-14T02:46:00+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3281","text":"val total = 4502050947L\nval nodes = 4061559986L\nval nonNodes = total - nodes\n(nodes * (8+8)) + (nonNodes * (8 + 16)) // Number of bytes to store the keys of tiles that could intersect geometries","dateUpdated":"2017-09-14T03:01:08+0000","dateFinished":"2017-09-14T03:01:09+0000","dateStarted":"2017-09-14T03:01:08+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ntotal: Long = 4502050947\n\nnodes: Long = 4061559986\n\nnonNodes: Long = 440490961\n\nres21: Long = 75556742840\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505357613357_2089328056","id":"20170914-025333_182749173","dateCreated":"2017-09-14T02:53:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3393","text":"(nodes * (8+1+8)) + (nonNodes * (8 + 1+16))","dateUpdated":"2017-09-14T03:00:40+0000","dateFinished":"2017-09-14T02:56:45+0000","dateStarted":"2017-09-14T02:56:45+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nres20: Long = 80058793787\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505365565900_2081602356","id":"20170914-050605_500171014","dateCreated":"2017-09-14T05:06:05+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4506","text":"// FOR FINLAND\nval df = ss.read.orc(\"s3://vectortiles/orc/europe/finland.orc\")\ndf\n  .select(\"id\")\n  .where(\"type = 'node'\")\n  .count()","dateUpdated":"2017-09-14T05:09:03+0000","dateFinished":"2017-09-14T05:09:22+0000","dateStarted":"2017-09-14T05:09:03+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndf: org.apache.spark.sql.DataFrame = [id: bigint, type: string ... 10 more fields]\n\nres9: Long = 33792531\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505357805027_-727177268","id":"20170914-025645_685582604","dateCreated":"2017-09-14T02:56:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3552","text":"// FOR THE WHOLE PLANET\nval df = ss.read.orc(\"s3://osm-pds/planet/planet-latest.orc\")\ndf\n    .select(\"id\")\n    .where(\"type = 'node' AND lon <= -34.767608642578125 AND lon >= -81.33865356445312 AND lat <= 12.623252653219012 AND lat >= -55.98609153380838 AND timestamp <= '2017-06-01 00:00:00.0'\")\n    .count()","dateUpdated":"2017-09-14T05:26:48+0000","dateFinished":"2017-09-14T05:36:03+0000","dateStarted":"2017-09-14T05:26:48+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\ndf: org.apache.spark.sql.DataFrame = [id: bigint, type: string ... 10 more fields]\n\nres14: Long = 132877507\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505365954495_-1886593820","id":"20170914-051234_1690547725","dateCreated":"2017-09-14T05:12:34+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4591","text":"143649996 - 132877507//33792531","dateUpdated":"2017-09-14T05:42:22+0000","dateFinished":"2017-09-14T05:42:22+0000","dateStarted":"2017-09-14T05:42:22+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nres15: Int = 10772489\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1505366579789_-1903604849","id":"20170914-052259_138168579","dateCreated":"2017-09-14T05:22:59+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4673"}],"name":"Working with ORC","id":"2CS2E53B7","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}